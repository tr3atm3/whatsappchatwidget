(function () {
  function CreateWhatsAppButtonAndWidget(config) {
    let isOpen = false;

    const currentDomain = window.location.href;
    const isSourceDomain = config.urlFields.filter((url) =>
      url.sourceUrl.includes(currentDomain)
    )[0];

    const createButton = () => {
      const button = document.createElement("button");
      button.style.position = "fixed";
      button.style.bottom = "20px";
      button.style[config.position === "bottom-left" ? "left" : "right"] =
        "20px";
      button.style.borderRadius = `${config.borderRadius}px`;
      button.style.backgroundColor = config.buttonBackground;
      button.style.color = "white";
      button.style.padding = "10px 20px";
      button.style.display = "flex";
      button.style.alignItems = "center";
      button.style.gap = "15px";
      button.style.fontSize = "16px";
      button.style.cursor = "pointer";
      button.style.zIndex = "1000";
      button.style.border = "none";
      button.style.outline = "none";
      button.style.fontWeight = "bold";

      const icon = document.createElement("span");
      const svg = `
      
  <svg fill="#ffffff" height="18px" width="18px" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 52 52" xml:space="preserve" 
    stroke-width="2">
    <g>
        <g>
            <path xmlns="http://www.w3.org/2000/svg" d="M0 0 C1.60536621 0.25740967 1.60536621 0.25740967 3.24316406 0.52001953 C49.0987205 8.12185178 93.88691504 25.16203601 132 52 C133.12482622 52.77499187 134.24983561 53.54971793 135.375 54.32421875 C143.67167615 60.08900779 151.39323067 66.35819196 159 73 C160.10794922 73.95712891 160.10794922 73.95712891 161.23828125 74.93359375 C163.17021524 76.6100014 165.08738447 78.30159741 167 80 C167.78890625 80.69609375 168.5778125 81.3921875 169.390625 82.109375 C199.34797304 108.75854964 222.86421226 141.80926118 240.02587891 177.95263672 C240.69249844 179.35370724 241.36704949 180.75102395 242.04833984 182.14501953 C257.50517462 213.87001688 265.72845537 248.1031612 270 283 C270.1045752 283.82709473 270.20915039 284.65418945 270.31689453 285.50634766 C271.36849027 295.12873086 271.24386297 304.83230488 271.25 314.5 C271.25101212 315.93362381 271.25101212 315.93362381 271.25204468 317.39620972 C271.23446023 333.12048475 270.5278145 348.45085815 268 364 C267.82839355 365.06879395 267.65678711 366.13758789 267.47998047 367.23876953 C257.42078546 427.92654927 230.57179964 484.19964548 189.11328125 529.66796875 C187.22623463 531.75034736 185.38941767 533.86503064 183.5625 536 C176.94519359 543.58233026 169.685148 550.51434878 162 557 C161.17628906 557.71285156 160.35257813 558.42570313 159.50390625 559.16015625 C153.30858362 564.44465475 146.91391766 569.40011585 140.375 574.25 C139.59987061 574.8282251 138.82474121 575.4064502 138.02612305 576.00219727 C133.17236784 579.56816927 128.22498702 582.71084392 122.95556641 585.63183594 C120.69393856 586.92476965 120.69393856 586.92476965 120 590 C119.01 590 118.02 590 117 590 C114.77296226 591.01466734 114.77296226 591.01466734 112.40234375 592.40625 C111.51869141 592.90253906 110.63503906 593.39882813 109.72460938 593.91015625 C108.34499023 594.69712891 108.34499023 594.69712891 106.9375 595.5 C105.11541504 596.53501546 103.29129303 597.56645567 101.46484375 598.59375 C100.656521 599.05458984 99.84819824 599.51542969 99.01538086 599.99023438 C97 601 97 601 95 601 C94.67 601.99 94.34 602.98 94 604 C93.01 604 92.02 604 91 604 C88.81015934 604.94817843 86.64584785 605.95607402 84.5 607 C78.33333333 610 78.33333333 610 75 610 C74.67 610.99 74.34 611.98 74 613 C72 613 70 613 68 613 C68 613.99 68 614.98 68 616 C67.01 615.67 66.02 615.34 65 615 C62.48855199 615.60322543 62.48855199 615.60322543 59.71484375 616.66015625 C58.63912109 617.03914062 57.56339844 617.418125 56.45507812 617.80859375 C54.71387695 618.42927734 54.71387695 618.42927734 52.9375 619.0625 C43.38652228 622.35771603 33.85504792 625.23848043 24 627.5 C22.95835693 627.74242432 21.91671387 627.98484863 20.84350586 628.23461914 C14.24679983 629.69636206 7.74075161 630.55548193 1 631 C0.67 631.99 0.34 632.98 0 634 C-1.98 633.67 -3.96 633.34 -6 633 C-6.33 633.66 -6.66 634.32 -7 635 C-10.04386724 635.08226668 -12.07175348 634.97608217 -15 634 C-16.87755022 634.03578908 -18.75440187 634.14715689 -20.625 634.3125 C-22.09839844 634.43044922 -22.09839844 634.43044922 -23.6015625 634.55078125 C-24.39304687 634.69902344 -25.18453125 634.84726562 -26 635 C-26.33 635.66 -26.66 636.32 -27 637 C-32.94 637 -38.88 637 -45 637 C-45 636.67 -45 636.34 -45 636 C-53.25 636 -61.5 636 -70 636 C-70 635.34 -70 634.68 -70 634 C-70.53625 634.33 -71.0725 634.66 -71.625 635 C-74.5391061 636.22699204 -76.86867708 636.14233286 -80 636 C-80.33 635.34 -80.66 634.68 -81 634 C-83.44811434 633.49098115 -83.44811434 633.49098115 -86.3125 633.3125 C-87.27800781 633.22613281 -88.24351562 633.13976562 -89.23828125 633.05078125 C-91.74820274 633.00462994 -93.62328843 633.24916238 -96 634 C-96.33 633.34 -96.66 632.68 -97 632 C-100.91765889 631.18690098 -104.17907588 630.62446732 -108 632 C-108 631.34 -108 630.68 -108 630 C-111.10142941 629.29973482 -114.2064641 628.61701544 -117.3125 627.9375 C-118.19357422 627.73833984 -119.07464844 627.53917969 -119.98242188 627.33398438 C-120.82998047 627.15029297 -121.67753906 626.96660156 -122.55078125 626.77734375 C-123.72120972 626.51812134 -123.72120972 626.51812134 -124.9152832 626.25366211 C-127.19113375 625.82565551 -127.19113375 625.82565551 -130 627 C-130 626.01 -130 625.02 -130 624 C-131.34964844 623.87238281 -131.34964844 623.87238281 -132.7265625 623.7421875 C-138.46569438 622.91163712 -143.89235339 620.95775482 -149.375 619.125 C-150.55658691 618.73006348 -151.73817383 618.33512695 -152.95556641 617.92822266 C-169.05269659 612.41685659 -184.88568211 605.75142742 -199.64453125 597.2421875 C-201.79631265 596.10741721 -203.62262503 595.45441666 -206 595 C-206.33 595.66 -206.66 596.32 -207 597 C-208.98 597 -210.96 597 -213 597 C-213.33 597.99 -213.66 598.98 -214 600 C-215.98 599.67 -217.96 599.34 -220 599 C-220.33 599.66 -220.66 600.32 -221 601 C-224 602 -224 602 -227 602 C-230.59679066 602.32326553 -230.59679066 602.32326553 -234 603 C-234.33 603.66 -234.66 604.32 -235 605 C-236.98 605 -238.96 605 -241 605 C-241.33 605.66 -241.66 606.32 -242 607 C-245.35083938 607.64854956 -248.70631285 608.02511635 -252.09375 608.4375 C-253.0528125 608.623125 -254.011875 608.80875 -255 609 C-255.33 609.66 -255.66 610.32 -256 611 C-257.98 611 -259.96 611 -262 611 C-262.33 611.99 -262.66 612.98 -263 614 C-264.98 613.67 -266.96 613.34 -269 613 C-269.33 613.99 -269.66 614.98 -270 616 C-271.98 615.67 -273.96 615.34 -276 615 C-276.33 615.99 -276.66 616.98 -277 618 C-278.98 617.67 -280.96 617.34 -283 617 C-283.33 617.66 -283.66 618.32 -284 619 C-286.0390625 619.59765625 -286.0390625 619.59765625 -288.625 620.0625 C-289.5221875 620.22621094 -290.419375 620.38992188 -291.34375 620.55859375 C-294.55790554 621.09271077 -297.76912238 621.57858118 -301 622 C-301 622.99 -301 623.98 -301 625 C-302.98 624.67 -304.96 624.34 -307 624 C-307 624.66 -307 625.32 -307 626 C-309.97 626 -312.94 626 -316 626 C-316.33 625.34 -316.66 624.68 -317 624 C-319.12576782 623.53348793 -319.12576782 623.53348793 -321.5625 623.375 C-322.38878906 623.30023437 -323.21507812 623.22546875 -324.06640625 623.1484375 C-324.70449219 623.09945312 -325.34257812 623.05046875 -326 623 C-326 622.34 -326 621.68 -326 621 C-326.804375 620.79375 -327.60875 620.5875 -328.4375 620.375 C-335.78314135 617.53984018 -341.80259108 612.86374339 -347 607 C-347 606.34 -347 605.68 -347 605 C-347.66 605 -348.32 605 -349 605 C-349.67119549 603.5437455 -350.33681807 602.08492133 -351 600.625 C-351.37125 599.81289063 -351.7425 599.00078125 -352.125 598.1640625 C-353 596 -353 596 -353 594 C-353.66 593.67 -354.32 593.34 -355 593 C-356.69772692 583.66250193 -356.11699913 574.37481413 -355 565 C-354.34 565 -353.68 565 -353 565 C-352.87882812 564.07316406 -352.75765625 563.14632812 -352.6328125 562.19140625 C-352.46523438 560.99386719 -352.29765625 559.79632812 -352.125 558.5625 C-351.96257812 557.36753906 -351.80015625 556.17257812 -351.6328125 554.94140625 C-351.42398438 553.97074219 -351.21515625 553.00007812 -351 552 C-350.34 551.67 -349.68 551.34 -349 551 C-348.58344201 548.8477837 -348.26491552 546.67609175 -348 544.5 C-347.73508448 542.32390825 -347.41655799 540.1522163 -347 538 C-346.34 537.67 -345.68 537.34 -345 537 C-344.58344201 534.8477837 -344.26491552 532.67609175 -344 530.5 C-343.73508448 528.32390825 -343.41655799 526.1522163 -343 524 C-342.34 523.67 -341.68 523.34 -341 523 C-340.58344201 520.8477837 -340.26491552 518.67609175 -340 516.5 C-339.73508448 514.32390825 -339.41655799 512.1522163 -339 510 C-338.34 509.67 -337.68 509.34 -337 509 C-336.58344201 506.8477837 -336.26491552 504.67609175 -336 502.5 C-335.73508448 500.32390825 -335.41655799 498.1522163 -335 496 C-334.34 495.67 -333.68 495.34 -333 495 C-332.58344201 492.8477837 -332.26491552 490.67609175 -332 488.5 C-331.73508448 486.32390825 -331.41655799 484.1522163 -331 482 C-330.34 481.67 -329.68 481.34 -329 481 C-327.37634182 476.76285994 -327.10559481 472.35504822 -328.73193359 468.07275391 C-330.85678098 463.63106132 -333.36266181 459.39368311 -335.81298828 455.12597656 C-352.09573681 425.96304481 -360.37183217 390.81357727 -365 358 C-365.17732666 356.78924805 -365.35465332 355.57849609 -365.53735352 354.33105469 C-367.17511834 342.43220111 -367.35193277 330.62155737 -367.3125 318.625 C-367.31233887 317.61952118 -367.31217773 316.61404236 -367.31201172 315.57809448 C-367.29501971 300.30364652 -366.45892543 285.4951477 -364.28125 270.36767578 C-363.90645788 267.21252477 -363.89409205 264.17282568 -364 261 C-363.34 261 -362.68 261 -362 261 C-361.92869873 260.08686035 -361.92869873 260.08686035 -361.85595703 259.15527344 C-361.31999447 253.04037459 -360.32900284 247.20973774 -358.875 241.25 C-358.65980713 240.35821045 -358.44461426 239.4664209 -358.22290039 238.54760742 C-354.9776319 225.47654533 -351.02639584 212.51887044 -345.75415039 200.11791992 C-344.83227559 197.90366798 -344.83227559 197.90366798 -345 195 C-344.34 195 -343.68 195 -343 195 C-342.82984375 194.46632813 -342.6596875 193.93265625 -342.484375 193.3828125 C-340.80579751 188.22207959 -338.92378003 183.1859745 -336.8671875 178.1640625 C-336.18632921 176.46498371 -335.57882957 174.73648872 -335 173 C-334.34 172.01 -333.68 171.02 -333 170 C-330.4289422 166.0126051 -327.96290193 161.98826193 -325.6875 157.82421875 C-322.99982073 152.96408627 -320.18695376 148.18914806 -317.3125 143.4375 C-316.82716797 142.61958984 -316.34183594 141.80167969 -315.84179688 140.95898438 C-315.37451172 140.18748047 -314.90722656 139.41597656 -314.42578125 138.62109375 C-314.00723877 137.9242749 -313.58869629 137.22745605 -313.1574707 136.50952148 C-312.77550537 136.01137939 -312.39354004 135.5132373 -312 135 C-311.34 135 -310.68 135 -310 135 C-309.77183594 134.3090625 -309.54367187 133.618125 -309.30859375 132.90625 C-307.70718259 129.34968313 -305.49686913 126.50978844 -303.0625 123.5 C-302.57305908 122.88761475 -302.08361816 122.27522949 -301.5793457 121.64428711 C-300.0620299 119.75523501 -298.53352511 117.87590968 -297 116 C-296.54915039 115.44715332 -296.09830078 114.89430664 -295.63378906 114.32470703 C-280.48522601 95.84796526 -263.87779835 78.76630038 -244.78027344 64.35644531 C-242.982882 62.98695726 -241.2132641 61.58691139 -239.4453125 60.1796875 C-223.65281107 47.76995363 -206.04388708 37.3957635 -187.86279297 28.8828125 C-185.93685974 27.97007665 -184.03294979 27.0199836 -182.12890625 26.0625 C-153.24467337 11.7240057 -121.75349056 3.78105131 -90 -1 C-89.14325684 -1.13277344 -88.28651367 -1.26554687 -87.40380859 -1.40234375 C-59.14053705 -5.56438084 -28.12621729 -4.54865458 0 0 Z M-65 37 C-65 36.67 -65 36.34 -65 36 C-71.42882667 35.89364074 -77.64761552 35.94126925 -84 37 C-84.33 37.33 -84.66 37.66 -85 38 C-85.94875 37.979375 -86.8975 37.95875 -87.875 37.9375 C-91.16735887 37.72305197 -91.16735887 37.72305197 -94 40 C-94.99 39.67 -95.98 39.34 -97 39 C-99.15576115 39.20787056 -99.15576115 39.20787056 -101.515625 39.75 C-102.42497803 39.94231201 -103.33433105 40.13462402 -104.27124023 40.33276367 C-105.25423096 40.55295166 -106.23722168 40.77313965 -107.25 41 C-108.27488525 41.22856689 -109.29977051 41.45713379 -110.35571289 41.69262695 C-157.13529658 52.4268739 -200.17293411 74.531154 -235.66015625 106.87890625 C-237.78804815 108.80786335 -239.94720859 110.69036353 -242.125 112.5625 C-248.96567414 118.53604644 -255.16252481 125.05166199 -261 132 C-261.45503906 132.53592773 -261.91007812 133.07185547 -262.37890625 133.62402344 C-271.07922971 143.9097639 -278.81811288 154.6049074 -286 166 C-286.42877441 166.67579102 -286.85754883 167.35158203 -287.29931641 168.04785156 C-307.36444733 199.97356515 -320.08041672 235.57783803 -325.875 272.75 C-326.03045792 273.74226593 -326.03045792 273.74226593 -326.1890564 274.75457764 C-335.79032215 337.01674314 -323.77935074 405.21714462 -290.20581055 458.92822266 C-286.62751656 465.07630988 -287.41444077 472.35481723 -289.10095215 479.02775574 C-289.60785386 480.81819339 -290.12898987 482.60464442 -290.66210938 484.38745117 C-290.94496292 485.37253159 -291.22781647 486.357612 -291.51924133 487.37254333 C-292.44878253 490.59961432 -293.39647685 493.82106322 -294.34375 497.04296875 C-294.99535861 499.29836199 -295.64552329 501.55417286 -296.29431152 503.81037903 C-297.99963227 509.7308008 -299.71912312 515.64699548 -301.44329834 521.56195068 C-304.20522383 531.03813252 -306.95472922 540.51782499 -309.6867218 550.00267982 C-310.64257165 553.30816677 -311.61011337 556.61007612 -312.57849121 559.91191101 C-313.16545253 561.94137509 -313.75194419 563.97097509 -314.33789062 566.00073242 C-314.74464775 567.37007935 -314.74464775 567.37007935 -315.15962219 568.76708984 C-316.55947479 573.66300636 -317.49515646 577.90190584 -317 583 C-315.11397415 585.30965141 -315.11397415 585.30965141 -311.99995422 585.29138184 C-307.13406902 585.14089503 -302.6396409 583.71585339 -298.00073242 582.33789062 C-297.02090897 582.05503708 -296.04108551 581.77218353 -295.03157043 581.48075867 C-292.91172542 580.86765739 -290.79309092 580.25035833 -288.67555809 579.62931824 C-285.3185902 578.64544145 -281.95826486 577.67392863 -278.59675598 576.70568848 C-269.04247331 573.95109201 -259.49512017 571.17278292 -249.94897461 568.39013672 C-244.10208512 566.68672064 -238.25156056 564.99629075 -232.39876747 563.3132782 C-230.17544823 562.67093613 -227.95360377 562.02346556 -225.73332787 561.37068176 C-222.62139259 560.45575006 -219.50511129 559.55730657 -216.38745117 558.66210938 C-215.48062592 558.39093796 -214.57380066 558.11976654 -213.63949585 557.84037781 C-206.85007836 555.91818445 -199.9105498 554.7190476 -193.06640625 556.9609375 C-192.24011719 557.42757812 -191.41382813 557.89421875 -190.5625 558.375 C-189.03302734 559.20064453 -189.03302734 559.20064453 -187.47265625 560.04296875 C-186.32667969 560.68878906 -185.18070313 561.33460938 -184 562 C-119.56450207 598.18713149 -42.59249542 606.22987665 28.5 586.875 C70.25862405 574.90168961 107.55898178 553.67393272 140 525 C140.5372168 524.52594727 141.07443359 524.05189453 141.62792969 523.56347656 C152.38047701 514.01061998 162.16104858 503.75173484 171.125 492.5 C171.58664551 491.92459473 172.04829102 491.34918945 172.52392578 490.75634766 C174.95226422 487.64203791 176.75307382 484.75478895 178 481 C178.66 481 179.32 481 180 481 C181.41302035 479.02531884 182.71566485 477.05540284 184 475 C184.99386719 473.50726562 184.99386719 473.50726562 186.0078125 471.984375 C200.48347166 449.87026839 211.91348183 426.18381078 220 401 C220.39960937 399.7728125 220.79921875 398.545625 221.2109375 397.28125 C227.78070833 375.94051791 232.40453846 353.3774796 231.92651367 330.96655273 C232 329 232 329 233 328 C236.6770348 278.99964881 223.72648976 225.76767008 200 183 C199.3179248 181.7627417 199.3179248 181.7627417 198.62207031 180.50048828 C197.13764956 177.82512407 195.63608565 175.1603863 194.125 172.5 C193.64804687 171.65493896 193.17109375 170.80987793 192.6796875 169.93920898 C192.23109375 169.16520752 191.7825 168.39120605 191.3203125 167.59375 C190.92086426 166.89958984 190.52141602 166.20542969 190.10986328 165.49023438 C189.7436084 164.99845703 189.37735352 164.50667969 189 164 C188.34 164 187.68 164 187 164 C186.88068115 163.40904541 186.7613623 162.81809082 186.63842773 162.20922852 C185.97991271 159.93048952 185.17982084 158.55308916 183.78515625 156.65234375 C183.34623047 156.04712891 182.90730469 155.44191406 182.45507812 154.81835938 C181.99552734 154.19767578 181.53597656 153.57699219 181.0625 152.9375 C180.15727495 151.69681673 179.25231743 150.45593823 178.34765625 149.21484375 C177.57292969 148.15394531 176.79820312 147.09304687 176 146 C175.34 145.01 174.68 144.02 174 143 C173.34 143 172.68 143 172 143 C171.773125 142.29875 171.54625 141.5975 171.3125 140.875 C169.66158712 137.25871465 167.7091165 134.91230024 165 132 C164.34 132 163.68 132 163 132 C162.76667969 131.45085937 162.53335937 130.90171875 162.29296875 130.3359375 C153.64323106 114.70891895 135.12095683 101.49779189 121 91 C120.06196533 90.29327148 120.06196533 90.29327148 119.10498047 89.57226562 C103.65288631 77.99575297 86.8858102 68.65978729 69.5 60.3125 C68.64631836 59.90241699 67.79263672 59.49233398 66.91308594 59.06982422 C62.33364326 56.9264694 57.90526826 55.23291017 53 54 C52.67 54.66 52.34 55.32 52 56 C52 55.01 52 54.02 52 53 C48.21178584 51.69805584 44.4188643 50.41037724 40.625 49.125 C39.03365234 48.57779297 39.03365234 48.57779297 37.41015625 48.01953125 C27.43581983 44.43100616 27.43581983 44.43100616 17 43 C16.34 42.690625 15.68 42.38125 15 42.0625 C11.08256447 40.67507492 7.15544713 40.11161325 3 40 C2.67 40.33 2.34 40.66 2 41 C1.67 40.34 1.34 39.68 1 39 C0.401875 39.20625 -0.19625 39.4125 -0.8125 39.625 C-3 40 -3 40 -6 38 C-6 38.66 -6 39.32 -6 40 C-6.86625 39.5359375 -6.86625 39.5359375 -7.75 39.0625 C-9.85801505 38.06704845 -11.70653231 37.39542546 -14 37 C-14.33 37.33 -14.66 37.66 -15 38 C-15 37.67 -15 37.34 -15 37 C-18.53501458 36.21226083 -21.90249788 35.82504198 -25.51953125 35.68359375 C-26.54111328 35.64169922 -27.56269531 35.59980469 -28.61523438 35.55664062 C-30.19788086 35.49766602 -30.19788086 35.49766602 -31.8125 35.4375 C-33.42415039 35.37272461 -33.42415039 35.37272461 -35.06835938 35.30664062 C-37.71212082 35.20089017 -40.3559711 35.09879767 -43 35 C-43 35.33 -43 35.66 -43 36 C-46.63 36 -50.26 36 -54 36 C-54 35.67 -54 35.34 -54 35 C-55.27875 34.979375 -56.5575 34.95875 -57.875 34.9375 C-58.59429687 34.92589844 -59.31359375 34.91429687 -60.0546875 34.90234375 C-62.23963474 35.01202986 -63.44115336 35.44115336 -65 37 Z M-53 35 C-53 35.33 -53 35.66 -53 36 C-50.03 36 -47.06 36 -44 36 C-44 35.67 -44 35.34 -44 35 C-46.97 35 -49.94 35 -53 35 Z M-42 635 C-38 636 -38 636 -38 636 Z " fill="#000000" transform="translate(448,84)"/>
        </g>
    </g>
</svg>
`;

      icon.innerHTML = svg;
      button.appendChild(icon);

      const text = document.createElement("span");
      text.innerText = config.ctaText;
      button.appendChild(text);

      button.addEventListener("click", () => {
        togglePopup();
        clearTimeout(toggleChatPopupTimer);
      });
      return button;
    };

    const createPopup = () => {
      const popup = document.createElement("div");
      popup.style.position = "fixed";
      popup.style.bottom = "80px";
      popup.style[config.position === "bottom-left" ? "left" : "right"] =
        "20px";
      popup.style.width = "300px";
      popup.style.borderRadius = "10px";
      popup.style.overflow = "hidden";
      popup.style.boxShadow = "0 4px 8px rgba(0,0,0,0.1)";
      popup.style.backgroundColor = "#E5E5E5";
      popup.style.zIndex = "1000";

      const header = document.createElement("div");
      header.style.display = "flex";
      header.style.alignItems = "center";
      header.style.justifyContent = "space-between";
      header.style.padding = "10px";
      header.style.backgroundColor = config.brandColor;

      const brandInfo = document.createElement("div");
      brandInfo.style.display = "flex";
      brandInfo.style.alignItems = "center";

      const brandImage = document.createElement("img");
      brandImage.src = isSourceDomain?.id
        ? isSourceDomain?.brandImageUrl || config.brandImageUrl || ""
        : config.brandImageUrl || "";
      brandImage.alt = config.brandName || "Brand Logo";
      brandImage.style.width = "32px";
      brandImage.style.height = "32px";
      brandImage.style.borderRadius = "50%";
      brandImage.style.marginRight = "8px";

      const brandText = document.createElement("div");
      brandText.style.display = "flex";
      brandText.style.flexDirection = "column";
      const brandName = document.createElement("span");
      brandName.innerText = config.brandName;
      brandName.style.color = "white";
      brandName.style.fontSize = "14px";
      brandText.appendChild(brandName);

      const brandSubtitle = document.createElement("span");
      brandSubtitle.innerText = config.brandSubtitle;
      brandSubtitle.style.color = "white";
      brandSubtitle.style.fontSize = "12px";
      brandText.appendChild(brandSubtitle);

      brandInfo.appendChild(brandImage);
      brandInfo.appendChild(brandText);

      const closeButton = document.createElement("button");
      closeButton.innerText = "✕";
      closeButton.style.backgroundColor = "transparent";
      closeButton.style.border = "none";
      closeButton.style.color = "white";
      closeButton.style.cursor = "pointer";
      closeButton.addEventListener("click", togglePopup);

      header.appendChild(brandInfo);
      header.appendChild(closeButton);

      const body = document.createElement("div");
      body.style.height = "200px";
      body.style.overflowY = "auto";
      body.style.padding = "10px";
      body.style.backgroundImage = 'url("/images/whatsappBG.jpg")';
      body.style.backgroundSize = "cover";

      const messageBubble = document.createElement("div");
      messageBubble.style.backgroundColor = "white";
      messageBubble.style.borderRadius = "10px";
      messageBubble.style.padding = "10px";
      messageBubble.style.marginBottom = "10px";

      const message = document.createElement("span");
      message.innerHTML = isSourceDomain?.id
        ? isSourceDomain?.onScreenMessage.replace(/\n/g, "<br>") ||
          config.defaultOnScreenMessage.replace(/\n/g, "<br>")
        : config.defaultOnScreenMessage.replace(/\n/g, "<br>");
      messageBubble.appendChild(message);

      body.appendChild(messageBubble);

      const footer = document.createElement("div");
      footer.style.padding = "10px";
      footer.style.textAlign = "center";

      const startButton = document.createElement("button");
      startButton.innerText = config.widgetCtaText;
      startButton.style.backgroundColor = config.buttonBackground;
      startButton.style.color = "white";
      startButton.style.border = "none";
      startButton.style.borderRadius = "5px";
      startButton.style.padding = "10px";
      startButton.style.width = "100%";
      startButton.style.cursor = "pointer";
      startButton.addEventListener("click", () => {
        window.open(
          `https://api.whatsapp.com/send?phone=${config.phoneNumber}&text=${
            isSourceDomain
              ? isSourceDomain?.preFilledMessage || config.defaultMessage
              : config.defaultMessage
          }`,
          "_blank"
        );
      });

      const poweredBy = document.createElement("p");
      poweredBy.innerText = `⚡ by Engageto`;
      poweredBy.style.margin = "5px";

      footer.appendChild(startButton);
      footer.appendChild(poweredBy);

      popup.appendChild(header);
      popup.appendChild(body);
      popup.appendChild(footer);
      return popup;
    };

    const togglePopup = () => {
      isOpen = !isOpen;
      render();
    };
    var toggleChatPopupTimer = setTimeout(() => {
      togglePopup();
    }, 5000);

    const render = () => {
      const existingButton = document.getElementById("chat-popup-button");
      const existingPopup = document.getElementById("chat-popup");

      if (existingButton) existingButton.remove();
      if (existingPopup) existingPopup.remove();

      const button = createButton();
      button.id = "chat-popup-button";
      document.body.appendChild(button);

      if (isOpen) {
        const popup = createPopup();
        popup.id = "chat-popup";
        document.body.appendChild(popup);
      }
    };

    render();
  }

  window.CreateWhatsAppButtonAndWidget = CreateWhatsAppButtonAndWidget;
})();
